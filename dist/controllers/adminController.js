"use strict";var path=require("path"),mongoose=require("mongoose"),formidable=require("formidable"),adminModel=mongoose.model("adminModel");exports.listGet=function(e,n){adminModel.find({},function(e,o){return e?(console.log(e),void n.end(e)):void n.render(path.join(__dirname,"../views/list.html"),{title:"商品列表",data:o},function(e,o){n.end(o)})})},exports.search=function(e,n){var o=e.body.name,i=new RegExp(o,"i");adminModel.find({name:i},function(e,i){return e?(console.log(e),void n.end(e)):void n.render(path.join(__dirname,"../views/list.html"),{title:"商品列表",name:o,data:i},function(e,o){n.end(o)})})},exports.addGet=function(e,n){n.render(path.join(__dirname,"../views/add.html"),{title:"添加商品"},function(e,o){n.end(o)})},exports.addPost=function(e,n){var o=new formidable.IncomingForm;o.uploadDir=path.join(__dirname,"../static/upload"),o.keepExtensions=!0,o.parse(e,function(e,o,i){adminModel.create({name:o.name,price:o.price,keyword:o.keyword,content:o.content,filepath:path.basename(i.uploadImg.path),createTime:Date.now()},function(e){return e?(console.log(e),void n.end(e)):void n.end('<script>alert("商品添加成功");window.location="/admin/list"</script>')})})},exports.editGet=function(e,n){var o=e.params.id;adminModel.find({_id:o},function(e,o){return e?(console.log(e),void n.end(e)):void n.render(path.join(__dirname,"../views/edit.html"),{title:"修改商品信息",data:o[0]},function(e,o){n.end(o)})})},exports.editPost=function(e,n){var o=new formidable.IncomingForm;o.uploadDir=path.join(__dirname,"../static/upload"),o.keepExtensions=!0,o.parse(e,function(e,o,i){console.log(i),0!=i.uploadImg.size?adminModel.update({_id:o.id},{name:o.name,price:o.price,keyword:o.keyword,content:o.content,filepath:path.basename(i.uploadImg.path)},function(e){return e?(console.log(e),void n.end(e)):void n.end('<script>alert("商品修改成功");window.location="/admin/list"</script>')}):adminModel.update({_id:o.id},{name:o.name,price:o.price,keyword:o.keyword,content:o.content},function(e){return e?(console.log(e),void n.end(e)):void n.end('<script>alert("商品修改成功");window.location="/admin/list"</script>')})})},exports.delGet=function(e,n){var o=e.params.id;adminModel.remove({_id:o},function(e){return e?(console.log(e),void n.end(e)):void n.end('<script>alert("商品删除成功");window.location="/admin/list"</script>')})};